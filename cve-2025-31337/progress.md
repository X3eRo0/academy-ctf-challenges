# CTF FTP Server Progress

## Project Overview
Creating a custom binary protocol FTP server with 3 memory corruption vulnerabilities (easy, medium, hard) for attack and defense CTF.

## Completed Steps
1. ✅ Project initialization and progress tracking setup
2. ✅ Design binary protocol specification
3. ✅ Plan vulnerability implementation strategy
4. ✅ Design credential storage system
5. ✅ Implement server architecture (fork server)
6. ✅ Implement chroot functionality
7. ✅ Add memory corruption vulnerabilities in FTP commands
8. ✅ Create test cases and documentation

## Implementation Complete!

### Files Created:
- `ftp_server.h` - Main header file with protocol definitions
- `server.c` - Main server implementation with fork architecture
- `protocol.c` - Packet handling and authentication functions
- `commands.c` - FTP command handlers with vulnerabilities
- `database.c` - SQLite database functions and utilities
- `user_admin.c` - User management utility
- `Makefile` - Build configuration
- `test_client.py` - Python test client with vulnerability testing
- `protocol.md` - Binary protocol specification
- `checker.py` - FAUST CTF gameserver checker script
- `checker_setup.py` - Service initialization script
- `CHECKER_DEPLOYMENT.md` - Checker deployment guide
- `README.md` - Complete project documentation

### Checker Features:
- ✅ **FAUST CTF Compatible**: Implements checkerlib.BaseChecker interface
- ✅ **Flag Management**: Places flags in random files with unique names
- ✅ **Service Verification**: Tests all FTP functionality (upload, download, list, mkdir)
- ✅ **Anonymous Access**: Uses anonymous login for CTF compatibility
- ✅ **Error Handling**: Comprehensive timeout and error management
- ✅ **State Persistence**: Stores flag locations and user credentials
- ✅ **Local Testing**: Mock implementation for testing without gameserver

## FTP Commands to Implement
- GET <filename> - Download file
- PUT <filename> <size> - Upload file
- LIST [path] - List directory contents
- MKDIR <dirname> - Create directory
- RMDIR <dirname> - Remove directory
- DELETE <filename> - Delete file
- RENAME <old> <new> - Rename file/directory
- STAT <path> - Get file/directory statistics
- SEARCH <pattern> - Search for files (custom command)

## Vulnerability Strategy (Memory Corruption in Commands)

### Easy Bug: Buffer Overflow in LIST command
- Fixed-size buffer for directory path processing
- No proper bounds checking when concatenating paths
- Exploitable via long directory names or path traversal attempts

### Medium Bug: Heap Overflow in PUT command
- Heap buffer allocated based on declared file size
- Server doesn't validate actual data length matches declared size
- Attacker can send more data than allocated, corrupting heap

### Hard Bug: Integer Overflow in SEARCH command
- Integer overflow in pattern matching buffer calculation
- Large pattern length causes wrap-around, leading to small allocation
- Results in heap corruption when pattern is copied to undersized buffer

## Technical Requirements
- Binary protocol (not plaintext)
- User authentication (username/password + anonymous)
- Per-user root directories with chroot
- Fork server architecture
- Credential storage system

## Credential Storage Design
- SQLite database storing hashed passwords
- Each user has associated home directory path
- Anonymous users get default sandbox directory
- Passwords hashed with salt for realistic security
