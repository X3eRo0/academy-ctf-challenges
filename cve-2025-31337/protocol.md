# Custom FTP Binary Protocol Specification

## Protocol Overview
- All integers are in network byte order (big-endian)
- All strings are null-terminated unless specified otherwise
- Maximum packet size: 65535 bytes

## Packet Structure
```
+----------------+------------------+------------------+
| Magic (4 bytes) | Type (1 byte)   | Length (2 bytes) |
+----------------+------------------+------------------+
| Payload (variable length)                           |
+-----------------------------------------------------+
```

- **Magic**: 0x46545021 ("FTP!")
- **Type**: Command/Response type
- **Length**: Length of payload (not including header)

## Authentication Phase

### LOGIN Command (Type: 0x01)
```
+-------------------+-------------------+----------------------+
| Username Len (1)  | Username (var)    | Password Len (1)     |
+-------------------+-------------------+----------------------+
| Password (var)    |
+-------------------+
```

### ANONYMOUS Command (Type: 0x02)
```
No payload - just header
```

### REGISTER Command (Type: 0x03)
```
+-------------------+-------------------+----------------------+
| Username Len (1)  | Username (var)    | Password Len (1)     |
+-------------------+-------------------+----------------------+
| Password (var)    |
+-------------------+
```
Creates a new user account with temporary directory.

### AUTH_RESPONSE (Type: 0x80)
```
+------------------+------------------------+
| Status (1 byte)  | Message Len (1 byte)   |
+------------------+------------------------+
| Message (var)    |
+------------------+
```
- Status: 0x00 = Success, 0x01 = Failure

## FTP Commands (After Authentication)

### GET Command (Type: 0x10)
```
+--------------------+------------------+
| Filename Len (2)   | Filename (var)   |
+--------------------+------------------+
```

### PUT Command (Type: 0x11)
```
+--------------------+------------------+------------------+
| Filename Len (2)   | Filename (var)   | File Size (4)    |
+--------------------+------------------+------------------+
| File Data (var)    |
+--------------------+
```

### LIST Command (Type: 0x12)
```
+------------------+---------------+
| Path Len (2)     | Path (var)    |
+------------------+---------------+
```

### MKDIR Command (Type: 0x13)
```
+------------------+------------------+
| Dir Name Len (2) | Dir Name (var)   |
+------------------+------------------+
```

### DELETE Command (Type: 0x14)
```
+--------------------+------------------+
| Filename Len (2)   | Filename (var)   |
+--------------------+------------------+
```

### RENAME Command (Type: 0x15)
```
+------------------+----------------+------------------+----------------+
| Old Name Len (2) | Old Name (var) | New Name Len (2) | New Name (var) |
+------------------+----------------+------------------+----------------+
```

### STAT Command (Type: 0x16)
```
+------------------+---------------+
| Path Len (2)     | Path (var)    |
+------------------+---------------+
```

### SEARCH Command (Type: 0x17) - VULNERABLE
```
+--------------------+--------------------+------------------+
| Pattern Len (4)    | Max Results (4)    | Pattern (var)    |
+--------------------+--------------------+------------------+
```

## Response Types

### FILE_DATA Response (Type: 0x90)
```
+------------------+------------------+
| File Size (4)    | File Data (var)  |
+------------------+------------------+
```

### FILE_LIST Response (Type: 0x91)
```
+-------------------+
| Entry Count (2)   |
+-------------------+
For each entry:
+------------------+------------------+------------------+------------------+
| Type (1)         | Name Len (2)     | Name (var)       | Size (4)         |
+------------------+------------------+------------------+------------------+
| Modified Time (4)|
+------------------+
```
- Type: 0x00 = File, 0x01 = Directory

### STAT_INFO Response (Type: 0x92)
```
+------------------+------------------+------------------+------------------+
| Type (1)         | Size (4)         | Modified (4)     | Permissions (2)  |
+------------------+------------------+------------------+------------------+
```

### SEARCH_RESULTS Response (Type: 0x93)
```
+-------------------+
| Result Count (2)  |
+-------------------+
For each result:
+------------------+------------------+------------------+
| Path Len (2)     | Path (var)       | Size (4)         |
+------------------+------------------+------------------+
```

### GENERIC_RESPONSE (Type: 0x9F)
```
+------------------+------------------------+
| Status (1 byte)  | Message Len (2 bytes)  |
+------------------+------------------------+
| Message (var)    |
+------------------+
```
- Status: 0x00 = Success, 0x01 = Error
